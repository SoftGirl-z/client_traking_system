<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fizyoterapi & Pilates Danƒ±≈üan Takip Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 5px;
            font-size: 2em;
        }

        .header p {
            color: #666;
        }

        .header-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #055596;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 8px 12px;
            font-size: 14px;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
        }

        .stat-card.blue .number { color: #667eea; }
        .stat-card.green .number { color: #10b981; }
        .stat-card.purple .number { color: #8b5cf6; }

        .search-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .search-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .clients-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .clients-header {
            padding: 20px;
            background: #f9fafb;
            border-bottom: 2px solid #e5e7eb;
        }

        .clients-header h2 {
            color: #333;
        }

        .client-card {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.3s;
        }

        .client-card:hover {
            background: #f9fafb;
        }

        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .client-info h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .client-details {
            color: #666;
            font-size: 14px;
            line-height: 1.8;
        }

        .client-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }

        .btn-icon {
            padding: 8px;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .btn-icon:hover {
            background: #f3f4f6;
        }

        .client-expanded {
            margin-top: 20px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-section strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        .sessions-list {
            margin-top: 20px;
        }

        .session-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e5e7eb;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .session-type {
            display: inline-block;
            padding: 4px 12px;
            background: #d1fae5;
            color: #065f46;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .session-details {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h3 {
            color: #333;
            font-size: 1.5em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 2px solid #e5e7eb;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .calendar-header {
            padding: 20px;
            background: #667eea;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .calendar-nav button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        .calendar-nav button:hover {
            background: rgba(255,255,255,0.3);
        }

        .calendar-nav h3 {
            margin: 0 20px;
            font-size: 1.5em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border: 1px solid #e5e7eb;
        }

        .calendar-day-header {
            background: #f9fafb;
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }

        .calendar-day {
            background: white;
            min-height: 100px;
            padding: 8px;
            position: relative;
        }

        .calendar-day.other-month {
            background: #f9fafb;
            color: #999;
        }

        .calendar-day.today {
            background: #eff6ff;
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .calendar-day.other-month .calendar-day-number {
            color: #999;
        }

        .calendar-event {
            background: #10b981;
            color: white;
            padding: 4px 6px;
            margin-bottom: 3px;
            border-radius: 4px;
            font-size: 11px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid rgba(255,255,255,0.5);
        }

        .calendar-event:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .calendar-event.physio {
            background: #667eea;
        }

        .calendar-event.pilates {
            background: #10b981;
        }

        .calendar-event.yoga {
            background: #8b5cf6;
        }

        .calendar-legend {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .calendar-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f9fafb;
        }

        .calendar-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .calendar-stat h4 {
            color: #666;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .calendar-stat .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .today-indicator {
            background: #667eea;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 8px;
        }

        .sessions-summary {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .sessions-summary-header {
            padding: 20px;
            background: #f9fafb;
            border-bottom: 2px solid #e5e7eb;
        }

        .sessions-summary-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .session-day-group {
            margin-bottom: 25px;
        }

        .session-day-title {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }

        .package-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .package-active {
            background: #d1fae5;
            color: #065f46;
        }

        .package-expiring {
            background: #fef3c7;
            color: #92400e;
        }

        .package-expired {
            background: #fee2e2;
            color: #991b1b;
        }

        .payment-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .payment-paid {
            background: #d1fae5;
            color: #065f46;
        }

        .payment-debt {
            background: #fee2e2;
            color: #991b1b;
        }

        .package-card {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .package-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .package-progress {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .package-progress-bar {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }

        .package-progress-bar.warning {
            background: #f59e0b;
        }

        .package-progress-bar.danger {
            background: #ef4444;
        }

        .finance-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .finance-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-left: 4px solid #667eea;
        }

        .finance-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .finance-card .amount {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .finance-card.income {
            border-left-color: #10b981;
        }

        .finance-card.income .amount {
            color: #10b981;
        }

        .finance-card.debt {
            border-left-color: #ef4444;
        }

        .finance-card.debt .amount {
            color: #ef4444;
        }

        .payment-list {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .payment-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-item:hover {
            background: #f9fafb;
        }

        .payment-date {
            color: #666;
            font-size: 12px;
        }

        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .filter-group select {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bar-label {
            min-width: 150px;
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .bar-background {
            flex: 1;
            height: 30px;
            background: #f3f4f6;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 12px;
            transition: width 0.5s ease;
        }

        .top-clients {
            display: grid;
            gap: 10px;
        }

        .top-client-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .top-client-rank {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .calendar-time-slot {
            padding: 5px;
            border-top: 1px solid #f3f4f6;
            font-size: 11px;
        }

        .time-event {
            background: #667eea;
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            margin: 2px 0;
            font-size: 10px;
            cursor: grab;
        }

        .time-event:active {
            cursor: grabbing;
        }

        .drag-over {
            background: #e0e7ff !important;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .reports-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .header-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .client-header {
                flex-direction: column;
            }

            .client-actions {
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè• Danƒ±≈üan Takip Sistemi</h1>
            <p>Fizyoterapi & Pilates & Yoga</p>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('clients')">üë• Danƒ±≈üanlar</button>
                <button class="tab" onclick="switchTab('calendar')">üìÖ Takvim</button>
                <button class="tab" onclick="switchTab('finance')">üí∞ Finans</button>
                <button class="tab" onclick="switchTab('reports')">üìä Raporlar</button>
            </div>
            <div class="header-buttons">
                <button class="btn btn-primary" onclick="openAddClientModal()">
                    ‚ûï Yeni Danƒ±≈üan
                </button>
                <button class="btn btn-success" onclick="openAddSessionModal()">
                    ‚ûï Yeni Seans
                </button>
                <button class="btn btn-success" onclick="openAddSessionModal()">
                    ‚ûï Paket Ekle
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card blue">
                <div>
                    <h3>Toplam Danƒ±≈üan</h3>
                    <div class="number" id="totalClients">0</div>
                </div>
                <div style="font-size: 40px;">üë•</div>
            </div>
            <div class="stat-card green">
                <div>
                    <h3>Toplam Seans</h3>
                    <div class="number" id="totalSessions">0</div>
                </div>
                <div style="font-size: 40px;">üìä</div>
            </div>
            <div class="stat-card purple">
                <div>
                    <h3>Bu Ay</h3>
                    <div class="number" id="thisMonthSessions">0</div>
                </div>
                <div style="font-size: 40px;">üìÖ</div>
            </div>
        </div>

        <!-- Clients Page -->
        <div id="clientsPage" class="page active">

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-group">
                <select id="filterStatus" onchange="applyFilters()">
                    <option value="all">T√ºm Durumlar</option>
                    <option value="active">Aktif Paketli</option>
                    <option value="inactive">Paketi Yok</option>
                </select>
                <select id="filterSessionType" onchange="applyFilters()">
                    <option value="all">T√ºm Seans T√ºrleri</option>
                    <option value="Fizyoterapi">Fizyoterapi</option>
                    <option value="Reformer Pilates">Reformer Pilates</option>
                    <option value="Yoga">Yoga</option>
                    <option value="Mat Pilates">Mat Pilates</option>
                </select>
                <select id="filterPayment" onchange="applyFilters()">
                    <option value="all">T√ºm √ñdeme Durumlarƒ±</option>
                    <option value="paid">√ñdemesi Tamam</option>
                    <option value="debt">Bor√ßlu</option>
                </select>
                <button class="btn btn-primary" onclick="clearFilters()" style="padding: 10px 20px;">
                    üîÑ Filtreleri Temizle
                </button>
            </div>
        </div>

        <!-- Search -->
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="üîç Danƒ±≈üan ara (isim veya telefon)..." oninput="searchClients()">
        </div>

        <!-- Clients List -->
        <div class="clients-container">
            <div class="clients-header">
                <h2>Danƒ±≈üanlar (<span id="clientCount">0</span>)</h2>
            </div>
            <div id="clientsList"></div>
        </div>
        </div>

        <!-- Calendar Page -->
        <div id="calendarPage" class="page">
            <div class="filter-bar">
                <div class="filter-group">
                    <select id="calendarViewType" onchange="renderCalendar()">
                        <option value="month">Aylƒ±k G√∂r√ºn√ºm</option>
                        <option value="week">Haftalƒ±k G√∂r√ºn√ºm (Saatli)</option>
                    </select>
                    <select id="calendarFilterType" onchange="renderCalendar()">
                        <option value="all">T√ºm Seans T√ºrleri</option>
                        <option value="Fizyoterapi">Sadece Fizyoterapi</option>
                        <option value="Reformer Pilates">Sadece Reformer Pilates</option>
                        <option value="Yoga">Sadece Yoga</option>
                        <option value="Mat Pilates">Sadece Mat Pilates</option>
                    </select>
                </div>
            </div>
            
            <div class="calendar-container">
                <div class="calendar-header">
                    <h2>üìÖ Seans Takvimi</h2>
                    <div class="calendar-nav">
                        <button onclick="previousMonth()">‚óÄ √ñnceki</button>
                        <h3 id="calendarMonth"></h3>
                        <button onclick="nextMonth()">Sonraki ‚ñ∂</button>
                        <button onclick="goToToday()" style="background: rgba(255,255,255,0.3); margin-left: 10px;">Bug√ºn</button>
                    </div>
                </div>
                <div class="calendar-stats" id="calendarStats"></div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div class="calendar-legend">
                    <strong style="color: #666;">Renk Kodlarƒ±:</strong>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #667eea;"></div>
                        <span>Fizyoterapi</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #10b981;"></div>
                        <span>Pilates</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8b5cf6;"></div>
                        <span>Yoga</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f59e0b;"></div>
                        <span>Diƒüer</span>
                    </div>
                </div>
            </div>

            <div class="sessions-summary">
                <div class="sessions-summary-header">
                    <h2>üìã Bu Ayki Seanslar</h2>
                </div>
                <div class="sessions-summary-content" id="sessionsSummary"></div>
            </div>
        </div>

        <!-- Reports Page -->
        <div id="reportsPage" class="page">
            <div class="reports-grid">
                <!-- Aylƒ±k Seans Grafiƒüi -->
                <div class="chart-container">
                    <div class="chart-title">üìà Aylƒ±k Seans Daƒüƒ±lƒ±mƒ±</div>
                    <div class="bar-chart" id="monthlySessionChart"></div>
                </div>

                <!-- Seans T√ºrleri -->
                <div class="chart-container">
                    <div class="chart-title">üéØ Seans T√ºr√º Daƒüƒ±lƒ±mƒ±</div>
                    <div class="bar-chart" id="sessionTypeChart"></div>
                </div>

                <!-- En Aktif Danƒ±≈üanlar -->
                <div class="chart-container">
                    <div class="chart-title">üèÜ En Aktif Danƒ±≈üanlar (Son 30 G√ºn)</div>
                    <div class="top-clients" id="topClientsChart"></div>
                </div>

                <!-- Gelir Grafiƒüi -->
                <div class="chart-container">
                    <div class="chart-title">üí∞ Aylƒ±k Gelir Trendi</div>
                    <div class="bar-chart" id="incomeChart"></div>
                </div>

                <!-- Haftalƒ±k ƒ∞statistik -->
                <div class="chart-container">
                    <div class="chart-title">üìÖ Haftalƒ±k Seans Daƒüƒ±lƒ±mƒ±</div>
                    <div class="bar-chart" id="weeklyChart"></div>
                </div>

                <!-- Paket Durumlarƒ± -->
                <div class="chart-container">
                    <div class="chart-title">üì¶ Paket Durumu √ñzeti</div>
                    <div class="bar-chart" id="packageStatusChart"></div>
                </div>
            </div>
        </div>

        <!-- Finance Page -->
        <div id="financePage" class="page">
            <div class="finance-summary">
                <div class="finance-card income">
                    <h3>üí∞ Bu Ay Gelir</h3>
                    <div class="amount" id="monthlyIncome">0 ‚Ç∫</div>
                </div>
                <div class="finance-card">
                    <h3>üìä Toplam Gelir</h3>
                    <div class="amount" id="totalIncome">0 ‚Ç∫</div>
                </div>
                <div class="finance-card debt">
                    <h3>‚ö†Ô∏è Bekleyen √ñdemeler</h3>
                    <div class="amount" id="totalDebt">0 ‚Ç∫</div>
                </div>
                <div class="finance-card">
                    <h3>üì¶ Aktif Paket</h3>
                    <div class="amount" id="activePackages">0</div>
                </div>
            </div>

            <div class="clients-container" style="margin-bottom: 30px;">
                <div class="clients-header">
                    <h2>üí≥ Danƒ±≈üan Paketleri ve √ñdemeler</h2>
                </div>
                <div id="clientPackagesList"></div>
            </div>

            <div class="payment-list">
                <div class="clients-header">
                    <h2>üìã Son √ñdemeler</h2>
                </div>
                <div id="paymentHistory"></div>
            </div>
        </div>
    </div>

    <!-- Add Client Modal -->
    <div id="addClientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Yeni Danƒ±≈üan Ekle</h3>
                <button class="close-btn" onclick="closeAddClientModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ad Soyad *</label>
                        <input type="text" id="clientName" required>
                    </div>
                    <div class="form-group">
                        <label>Telefon *</label>
                        <input type="tel" id="clientPhone" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>E-posta</label>
                        <input type="email" id="clientEmail">
                    </div>
                    <div class="form-group">
                        <label>Doƒüum Tarihi</label>
                        <input type="date" id="clientBirthDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>Tƒ±bbi Ge√ßmi≈ü</label>
                    <textarea id="clientMedicalHistory" placeholder="Kronik hastalƒ±klar, ge√ßirilmi≈ü ameliyatlar, ila√ß kullanƒ±mƒ±..."></textarea>
                </div>
                <div class="form-group">
                    <label>≈ûikayetler</label>
                    <textarea id="clientComplaints" placeholder="Bel aƒürƒ±sƒ±, boyun aƒürƒ±sƒ±, eklem problemleri..."></textarea>
                </div>
                <div class="form-group">
                    <label>Hedefler</label>
                    <textarea id="clientGoals" placeholder="Aƒürƒ± azaltma, esneklik artƒ±rma, kuvvet kazanma..."></textarea>
                </div>
                <div class="form-group">
                    <label>Notlar</label>
                    <textarea id="clientNotes" placeholder="Ekstra bilgiler, √∂zel durumlar..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveClient()">Danƒ±≈üan Ekle</button>
                <button class="btn" style="background: #e5e7eb;" onclick="closeAddClientModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- Add Session Modal -->
    <div id="addSessionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Yeni Seans Ekle</h3>
                <button class="close-btn" onclick="closeAddSessionModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Danƒ±≈üan *</label>
                        <select id="sessionClient" required onchange="updatePackageInfo()"></select>
                    </div>
                    <div class="form-group">
                        <label>Seans T√ºr√º *</label>
                        <select id="sessionType">
                            <option value="Fizyoterapi">Fizyoterapi</option>
                            <option value="Reformer Pilates">Reformer Pilates</option>
                            <option value="Yoga">Yoga</option>
                            <option value="Mat Pilates">Mat Pilates</option>
                            <option value="Deƒüerlendirme">Deƒüerlendirme</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tarih *</label>
                        <input type="date" id="sessionDate" required>
                 </div>
                 <div class="form-group">
                    <label>Saat *</label>
                    <input type="time" id="sessionTime" required>
                 </div>
              </div>
               <div class="form-group">
                    <label>S√ºre (dk)</label>
                    <input type="number" id="sessionDuration" value="60" min="15" step="15">
               </div>

                <div class="form-group">
                    <label>≈ûikayetler / Durum</label>
                    <textarea id="sessionComplaints" placeholder="Danƒ±≈üanƒ±n bug√ºnk√º ≈üikayetleri ve genel durumu..."></textarea>
                </div>
                <div class="form-group">
                    <label>Deƒüerlendirme</label>
                    <textarea id="sessionAssessment" placeholder="Post√ºr analizi, hareket deƒüerlendirmesi, test sonu√ßlarƒ±..."></textarea>
                </div>
                <div class="form-group">
                    <label>Uygulanan Tedavi / Egzersizler</label>
                    <textarea id="sessionTreatment" placeholder="Manuel terapi, modaliteler, yapƒ±lan egzersizler, kullanƒ±lan ekipmanlar..."></textarea>
                </div>
                <div class="form-group">
                    <label>Verilen Egzersizler</label>
                    <textarea id="sessionExercises" placeholder="Seans sƒ±rasƒ±nda √∂ƒüretilen yeni egzersizler..."></textarea>
                </div>
                <div class="form-group">
                    <label>Ev Programƒ± / √ñneriler</label>
                    <textarea id="sessionHomeProgram" placeholder="Evde yapƒ±lacak egzersizler, dikkat edilmesi gerekenler..."></textarea>
                </div>
                <div class="form-group">
                    <label>Sonraki Seans Planƒ±</label>
                    <textarea id="sessionNextPlan" placeholder="Bir sonraki seansta odaklanƒ±lacak konular..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveSession()">Seans Kaydet</button>
                <button class="btn" style="background: #e5e7eb;" onclick="closeAddSessionModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- Add Package Modal -->
    <div id="addPackageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Yeni Paket Ekle</h3>
                <button class="close-btn" onclick="closeAddPackageModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Danƒ±≈üan *</label>
                    <select id="packageClient" required></select>
                </div>
                <div class="form-group">
                    <label>Paket Adƒ± *</label>
                    <input type="text" id="packageName" placeholder="√ñrn: 10 Seans Pilates Paketi" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Toplam Seans *</label>
                        <input type="number" id="packageSessions" min="1" value="10" required>
                    </div>
                    <div class="form-group">
                        <label>Fiyat (‚Ç∫) *</label>
                        <input type="number" id="packagePrice" min="0" step="0.01" placeholder="0.00" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>√ñdenen Tutar (‚Ç∫)</label>
                        <input type="number" id="packagePaid" min="0" step="0.01" value="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Ba≈ülangƒ±√ß Tarihi</label>
                        <input type="date" id="packageStartDate">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notlar</label>
                    <textarea id="packageNotes" rows="2" placeholder="Paket ile ilgili notlar..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="savePackage()">Paket Ekle</button>
                <button class="btn" style="background: #e5e7eb;" onclick="closeAddPackageModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>√ñdeme Al</h3>
                <button class="close-btn" onclick="closePaymentModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="paymentPackageInfo" style="padding: 15px; background: #f9fafb; border-radius: 8px; margin-bottom: 20px;"></div>
                <div class="form-group">
                    <label>√ñdeme Tutarƒ± (‚Ç∫) *</label>
                    <input type="number" id="paymentAmount" min="0" step="0.01" placeholder="0.00" required>
                </div>
                <div class="form-group">
                    <label>√ñdeme Tarihi *</label>
                    <input type="date" id="paymentDate" required>
                </div>
                <div class="form-group">
                    <label>√ñdeme Y√∂ntemi</label>
                    <select id="paymentMethod">
                        <option value="Nakit">Nakit</option>
                        <option value="Kredi Kartƒ±">Kredi Kartƒ±</option>
                        <option value="Banka Transferi">Banka Transferi</option>
                        <option value="Diƒüer">Diƒüer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Not</label>
                    <textarea id="paymentNote" rows="2" placeholder="√ñdeme notu..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="savePayment()">√ñdeme Kaydet</button>
                <button class="btn" style="background: #e5e7eb;" onclick="closePaymentModal()">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <script>
        let clients = [];
        let sessions = [];
        let packages = [];
        let payments = [];
        let expandedClientId = null;
        let currentCalendarDate = new Date();
        let selectedPackageId = null;

        // Sayfa y√ºklendiƒüinde verileri y√ºkle
        window.onload = function() {
            loadData();
            document.getElementById('sessionDate').valueAsDate = new Date();
        };

        async function loadData() {
            try {
                const clientsData = await window.storage.get('physio-clients-v2');
                const sessionsData = await window.storage.get('physio-sessions-v2');
                const packagesData = await window.storage.get('physio-packages');
                const paymentsData = await window.storage.get('physio-payments');
                
                if (clientsData) clients = JSON.parse(clientsData.value);
                if (sessionsData) sessions = JSON.parse(sessionsData.value);
                if (packagesData) packages = JSON.parse(packagesData.value);
                if (paymentsData) payments = JSON.parse(paymentsData.value);
                
                renderClients();
                updateStats();
                renderCalendar();
                renderFinancePage();
            } catch (error) {
                console.log('ƒ∞lk kullanƒ±m - veri y√ºklenmedi');
                renderClients();
                renderCalendar();
                renderFinancePage();
            }
        }

        async function saveData() {
            try {
                await window.storage.set('physio-clients-v2', JSON.stringify(clients));
                await window.storage.set('physio-sessions-v2', JSON.stringify(sessions));
                await window.storage.set('physio-packages', JSON.stringify(packages));
                await window.storage.set('physio-payments', JSON.stringify(payments));
            } catch (error) {
                console.error('Kayƒ±t hatasƒ±:', error);
                alert('Veri kaydedilirken hata olu≈ütu!');
            }
        }

        function openAddClientModal() {
            document.getElementById('addClientModal').classList.add('active');
            clearClientForm();
        }

        function closeAddClientModal() {
            document.getElementById('addClientModal').classList.remove('active');
        }

        function clearClientForm() {
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientBirthDate').value = '';
            document.getElementById('clientMedicalHistory').value = '';
            document.getElementById('clientComplaints').value = '';
            document.getElementById('clientGoals').value = '';
            document.getElementById('clientNotes').value = '';
        }

        function saveClient() {
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();

            if (!name || !phone) {
                alert('Ad Soyad ve Telefon alanlarƒ± zorunludur!');
                return;
            }

            const newClient = {
                id: Date.now().toString(),
                name: name,
                phone: phone,
                email: document.getElementById('clientEmail').value.trim(),
                birthDate: document.getElementById('clientBirthDate').value,
                medicalHistory: document.getElementById('clientMedicalHistory').value.trim(),
                complaints: document.getElementById('clientComplaints').value.trim(),
                goals: document.getElementById('clientGoals').value.trim(),
                notes: document.getElementById('clientNotes').value.trim(),
                createdAt: new Date().toISOString(),
                totalSessions: 0
            };

            clients.push(newClient);
            saveData();
            renderClients();
            updateStats();
            closeAddClientModal();
        }

        function openAddSessionModal(clientId = null) {
            const modal = document.getElementById('addSessionModal');
            modal.classList.add('active');
            
            // Danƒ±≈üan listesini doldur
            const select = document.getElementById('sessionClient');
            select.innerHTML = '<option value="">Se√ßiniz...</option>';
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                if (clientId && client.id === clientId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
            
            clearSessionForm();
        }

        function closeAddSessionModal() {
            document.getElementById('addSessionModal').classList.remove('active');
        }

        function clearSessionForm() {
            document.getElementById('sessionDate').valueAsDate = new Date();
            document.getElementById('sessionType').value = 'Fizyoterapi';
            document.getElementById('sessionDuration').value = '60';
            document.getElementById('sessionComplaints').value = '';
            document.getElementById('sessionAssessment').value = '';
            document.getElementById('sessionTreatment').value = '';
            document.getElementById('sessionExercises').value = '';
            document.getElementById('sessionHomeProgram').value = '';
            document.getElementById('sessionNextPlan').value = '';
        }

        function saveSession() {
            const clientId = document.getElementById('sessionClient').value;
            
            if (!clientId) {
                alert('L√ºtfen bir danƒ±≈üan se√ßiniz!');
                return;
            }

            const newSession = {
                id: Date.now().toString(),
                clientId: clientId,
                date: document.getElementById('sessionDate').value,
                time: document.getElementById('sessionTime').value,
                type: document.getElementById('sessionType').value,
                duration: document.getElementById('sessionDuration').value,
                complaints: document.getElementById('sessionComplaints').value.trim(),
                assessment: document.getElementById('sessionAssessment').value.trim(),
                treatment: document.getElementById('sessionTreatment').value.trim(),
                exercises: document.getElementById('sessionExercises').value.trim(),
                homeProgram: document.getElementById('sessionHomeProgram').value.trim(),
                nextPlan: document.getElementById('sessionNextPlan').value.trim(),
                createdAt: new Date().toISOString()
            };

            sessions.push(newSession);
            
            // Danƒ±≈üanƒ±n toplam seans sayƒ±sƒ±nƒ± g√ºncelle
            const client = clients.find(c => c.id === clientId);
            if (client) {
                client.totalSessions = (client.totalSessions || 0) + 1;
            }

            // Aktif paketten seans d√º≈ü
            const activePackage = packages.find(p => p.clientId === clientId && p.status === 'active');
            if (activePackage && activePackage.remainingSessions > 0) {
                activePackage.remainingSessions--;
                if (activePackage.remainingSessions === 0) {
                    activePackage.status = 'completed';
                }
            }
            
            saveData();
            renderClients();
            updateStats();
            closeAddSessionModal();
            renderCalendar();
            renderFinancePage();
        }

        function deleteClient(clientId) {
            if (!confirm('Bu danƒ±≈üanƒ± silmek istediƒüinizden emin misiniz?')) {
                return;
            }

            clients = clients.filter(c => c.id !== clientId);
            sessions = sessions.filter(s => s.clientId !== clientId);
            
            saveData();
            renderClients();
            updateStats();
            renderCalendar();
            renderFinancePage();
        }

        function updatePackageInfo() {
            const clientId = document.getElementById('sessionClient').value;
            const infoDiv = document.getElementById('packageInfo');
            const contentDiv = document.getElementById('packageInfoContent');

            if (!clientId) {
                infoDiv.style.display = 'none';
                return;
            }

            const activePackage = packages.find(p => p.clientId === clientId && p.status === 'active');
            
            if (activePackage) {
                infoDiv.style.display = 'block';
                const usedSessions = activePackage.totalSessions - activePackage.remainingSessions;
                contentDiv.innerHTML = `
                    ${activePackage.name}<br>
                    Kalan Seans: <strong>${activePackage.remainingSessions}/${activePackage.totalSessions}</strong><br>
                    Kalan Bor√ß: <strong>${(activePackage.price - activePackage.paidAmount).toFixed(2)} ‚Ç∫</strong>
                `;
            } else {
                infoDiv.style.display = 'block';
                contentDiv.innerHTML = '<span style="color: #dc2626;">‚ö†Ô∏è Aktif paket yok</span>';
            }
        }

        // Package Functions
        function openAddPackageModal(clientId = null) {
            const modal = document.getElementById('addPackageModal');
            modal.classList.add('active');
            
            const select = document.getElementById('packageClient');
            select.innerHTML = '<option value="">Se√ßiniz...</option>';
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                if (clientId && client.id === clientId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });

            document.getElementById('packageStartDate').valueAsDate = new Date();
        }

        function closeAddPackageModal() {
            document.getElementById('addPackageModal').classList.remove('active');
            document.getElementById('packageName').value = '';
            document.getElementById('packageSessions').value = '10';
            document.getElementById('packagePrice').value = '';
            document.getElementById('packagePaid').value = '0';
            document.getElementById('packageNotes').value = '';
        }

        function savePackage() {
            const clientId = document.getElementById('packageClient').value;
            const name = document.getElementById('packageName').value.trim();
            const totalSessions = parseInt(document.getElementById('packageSessions').value);
            const price = parseFloat(document.getElementById('packagePrice').value);
            const paidAmount = parseFloat(document.getElementById('packagePaid').value) || 0;

            if (!clientId || !name || !totalSessions || !price) {
                alert('L√ºtfen zorunlu alanlarƒ± doldurun!');
                return;
            }

            const newPackage = {
                id: Date.now().toString(),
                clientId: clientId,
                name: name,
                totalSessions: totalSessions,
                remainingSessions: totalSessions,
                price: price,
                paidAmount: paidAmount,
                startDate: document.getElementById('packageStartDate').value,
                notes: document.getElementById('packageNotes').value.trim(),
                status: 'active',
                createdAt: new Date().toISOString()
            };

            packages.push(newPackage);

            // ƒ∞lk √∂deme varsa kaydet
            if (paidAmount > 0) {
                const payment = {
                    id: Date.now().toString() + '-initial',
                    packageId: newPackage.id,
                    clientId: clientId,
                    amount: paidAmount,
                    date: newPackage.startDate || new Date().toISOString().split('T')[0],
                    method: 'Nakit',
                    note: 'ƒ∞lk √∂deme',
                    createdAt: new Date().toISOString()
                };
                payments.push(payment);
            }

            saveData();
            renderFinancePage();
            closeAddPackageModal();
            alert('Paket ba≈üarƒ±yla olu≈üturuldu!');
        }

        // Payment Functions
        function openPaymentModal(packageId) {
            selectedPackageId = packageId;
            const pkg = packages.find(p => p.id === packageId);
            if (!pkg) return;

            const client = clients.find(c => c.id === pkg.clientId);
            const remaining = pkg.price - pkg.paidAmount;

            document.getElementById('paymentPackageInfo').innerHTML = `
                <strong>Danƒ±≈üan:</strong> ${client.name}<br>
                <strong>Paket:</strong> ${pkg.name}<br>
                <strong>Toplam Tutar:</strong> ${pkg.price.toFixed(2)} ‚Ç∫<br>
                <strong>√ñdenen:</strong> ${pkg.paidAmount.toFixed(2)} ‚Ç∫<br>
                <strong>Kalan Bor√ß:</strong> <span style="color: #dc2626; font-weight: bold;">${remaining.toFixed(2)} ‚Ç∫</span>
            `;

            document.getElementById('paymentAmount').value = remaining.toFixed(2);
            document.getElementById('paymentDate').valueAsDate = new Date();
            document.getElementById('addPaymentModal').classList.add('active');
            
            const modal = document.getElementById('paymentModal');
            modal.classList.add('active');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            selectedPackageId = null;
        }

        function savePayment() {
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            
            if (!amount || amount <= 0) {
                alert('Ge√ßerli bir tutar girin!');
                return;
            }

            const pkg = packages.find(p => p.id === selectedPackageId);
            if (!pkg) return;

            const remaining = pkg.price - pkg.paidAmount;
            if (amount > remaining) {
                if (!confirm(`Girilen tutar kalan bor√ßtan fazla (${remaining.toFixed(2)} ‚Ç∫). Devam etmek istiyor musunuz?`)) {
                    return;
                }
            }

            const payment = {
                id: Date.now().toString(),
                packageId: selectedPackageId,
                clientId: pkg.clientId,
                amount: amount,
                date: document.getElementById('paymentDate').value,
                method: document.getElementById('paymentMethod').value,
                note: document.getElementById('paymentNote').value.trim(),
                createdAt: new Date().toISOString()
            };

            payments.push(payment);
            pkg.paidAmount += amount;

            saveData();
            renderFinancePage();
            closePaymentModal();
            alert('√ñdeme ba≈üarƒ±yla kaydedildi!');
        }

        function renderFinancePage() {
            // ƒ∞statistikleri hesapla
            const now = new Date();
            const thisMonthPayments = payments.filter(p => {
                const paymentDate = new Date(p.date);
                return paymentDate.getMonth() === now.getMonth() && 
                       paymentDate.getFullYear() === now.getFullYear();
            });

            const monthlyIncome = thisMonthPayments.reduce((sum, p) => sum + p.amount, 0);
            const totalIncome = payments.reduce((sum, p) => sum + p.amount, 0);
            const totalDebt = packages.reduce((sum, p) => sum + (p.price - p.paidAmount), 0);
            const activePackagesCount = packages.filter(p => p.status === 'active').length;

            document.getElementById('monthlyIncome').textContent = monthlyIncome.toFixed(2) + ' ‚Ç∫';
            document.getElementById('totalIncome').textContent = totalIncome.toFixed(2) + ' ‚Ç∫';
            document.getElementById('totalDebt').textContent = totalDebt.toFixed(2) + ' ‚Ç∫';
            document.getElementById('activePackages').textContent = activePackagesCount;

            // Danƒ±≈üan paketlerini listele
            const container = document.getElementById('clientPackagesList');
            
            if (clients.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Hen√ºz danƒ±≈üan yok</p></div>';
                return;
            }

            container.innerHTML = clients.map(client => {
                const clientPackages = packages.filter(p => p.clientId === client.id);
                const activePackage = clientPackages.find(p => p.status === 'active');
                const totalDebt = clientPackages.reduce((sum, p) => sum + (p.price - p.paidAmount), 0);

                return `
                    <div class="client-card">
                        <div class="client-header">
                            <div class="client-info">
                                <h3>
                                    ${client.name}
                                    ${activePackage ? `<span class="package-badge package-active">
                                        ${activePackage.remainingSessions}/${activePackage.totalSessions} seans kaldƒ±
                                    </span>` : ''}
                                    ${totalDebt > 0 ? `<span class="payment-status payment-debt">
                                        üí≥ ${totalDebt.toFixed(2)} ‚Ç∫ bor√ß
                                    </span>` : `<span class="payment-status payment-paid">
                                        ‚úì √ñdemesi tamam
                                    </span>`}
                                </h3>
                            </div>
                            <button class="btn btn-success btn-small" onclick="openAddPackageModal('${client.id}')">
                                üì¶ Yeni Paket
                            </button>
                        </div>
                        
                        ${clientPackages.length > 0 ? `
                            <div style="margin-top: 15px;">
                                ${clientPackages.map(pkg => {
                                    const usedSessions = pkg.totalSessions - pkg.remainingSessions;
                                    const progressPercent = (usedSessions / pkg.totalSessions) * 100;
                                    const paymentPercent = (pkg.paidAmount / pkg.price) * 100;
                                    const remaining = pkg.price - pkg.paidAmount;

                                    return `
                                        <div class="package-card">
                                            <div class="package-header">
                                                <div>
                                                    <strong>${pkg.name}</strong>
                                                    <span class="package-badge ${pkg.status === 'active' ? 'package-active' : 'package-expired'}">
                                                        ${pkg.status === 'active' ? 'Aktif' : 'Tamamlandƒ±'}
                                                    </span>
                                                </div>
                                                ${remaining > 0 ? `
                                                    <button class="btn btn-success btn-small" onclick="openPaymentModal('${pkg.id}')">
                                                        üí∞ √ñdeme Al
                                                    </button>
                                                ` : ''}
                                            </div>
                                            <div style="font-size: 13px; color: #666; margin: 8px 0;">
                                                üìä Kullanƒ±lan: ${usedSessions}/${pkg.totalSessions} seans
                                            </div>
                                            <div class="package-progress">
                                                <div class="package-progress-bar ${progressPercent > 80 ? 'danger' : progressPercent > 50 ? 'warning' : ''}" 
                                                     style="width: ${progressPercent}%"></div>
                                            </div>
                                            <div style="font-size: 13px; color: #666; margin-top: 8px;">
                                                üí≥ √ñdenen: ${pkg.paidAmount.toFixed(2)} ‚Ç∫ / ${pkg.price.toFixed(2)} ‚Ç∫
                                                ${remaining > 0 ? `<span style="color: #dc2626; font-weight: 600;"> (Kalan: ${remaining.toFixed(2)} ‚Ç∫)</span>` : 
                                                  `<span style="color: #059669; font-weight: 600;"> ‚úì Tamamlandƒ±</span>`}
                                            </div>
                                            <div class="package-progress" style="margin-top: 5px;">
                                                <div class="package-progress-bar" style="width: ${paymentPercent}%; background: #667eea;"></div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : '<p style="color: #999; font-size: 14px; margin-top: 10px;">Hen√ºz paket yok</p>'}
                    </div>
                `;
            }).join('');

            // √ñdeme ge√ßmi≈üini listele
            const paymentContainer = document.getElementById('paymentHistory');
            const recentPayments = payments.slice().sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 20);

            if (recentPayments.length === 0) {
                paymentContainer.innerHTML = '<div class="empty-state"><p>Hen√ºz √∂deme kaydƒ± yok</p></div>';
                return;
            }

            paymentContainer.innerHTML = recentPayments.map(payment => {
                const client = clients.find(c => c.id === payment.clientId);
                const pkg = packages.find(p => p.id === payment.packageId);
                
                return `
                    <div class="payment-item">
                        <div>
                            <strong>${client ? client.name : 'Bilinmeyen'}</strong>
                            <div class="payment-date">
                                ${new Date(payment.date).toLocaleDateString('tr-TR')} ‚Ä¢ ${payment.method}
                                ${payment.note ? ` ‚Ä¢ ${payment.note}` : ''}
                            </div>
                            ${pkg ? `<div class="payment-date">${pkg.name}</div>` : ''}
                        </div>
                        <div style="text-align: right;">
                            <strong style="color: #10b981; font-size: 18px;">+${payment.amount.toFixed(2)} ‚Ç∫</strong>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteSession(sessionId) {
            if (!confirm('Bu seansƒ± silmek istediƒüinizden emin misiniz?')) {
                return;
            }

            const session = sessions.find(s => s.id === sessionId);
            sessions = sessions.filter(s => s.id !== sessionId);
            
            // Danƒ±≈üanƒ±n toplam seans sayƒ±sƒ±nƒ± g√ºncelle
            if (session) {
                const client = clients.find(c => c.id === session.clientId);
                if (client) {
                    client.totalSessions = Math.max(0, (client.totalSessions || 0) - 1);
                }
            }
            
            saveData();
            renderClients();
            updateStats();
        }

        function toggleClientExpanded(clientId) {
            expandedClientId = expandedClientId === clientId ? null : clientId;
            renderClients();
        }

        function searchClients() {
            renderClients();
        }

        function renderClients() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const typeFilter = document.getElementById('filterSessionType').value;
            const paymentFilter = document.getElementById('filterPayment').value;

            let filteredClients = clients.filter(client => {
                // Arama filtresi
                const matchesSearch = client.name.toLowerCase().includes(searchTerm) ||
                                    client.phone.includes(searchTerm);
                if (!matchesSearch) return false;

                // Paket durumu filtresi
                if (statusFilter !== 'all') {
                    const hasActivePackage = packages.some(p => p.clientId === client.id && p.status === 'active');
                    if (statusFilter === 'active' && !hasActivePackage) return false;
                    if (statusFilter === 'inactive' && hasActivePackage) return false;
                }

                // Seans t√ºr√º filtresi
                if (typeFilter !== 'all') {
                    const hasSessionType = sessions.some(s => s.clientId === client.id && s.type === typeFilter);
                    if (!hasSessionType) return false;
                }

                // √ñdeme durumu filtresi
                if (paymentFilter !== 'all') {
                    const clientPackages = packages.filter(p => p.clientId === client.id);
                    const totalDebt = clientPackages.reduce((sum, p) => sum + (p.price - p.paidAmount), 0);
                    if (paymentFilter === 'paid' && totalDebt > 0) return false;
                    if (paymentFilter === 'debt' && totalDebt <= 0) return false;
                }

                return true;
            });

            const container = document.getElementById('clientsList');
            document.getElementById('clientCount').textContent = filteredClients.length;

            if (filteredClients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 60px; margin-bottom: 20px;">üë§</div>
                        <p>Hen√ºz danƒ±≈üan eklenmemi≈ü</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredClients.map(client => {
                const clientSessions = sessions.filter(s => s.clientId === client.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                const isExpanded = expandedClientId === client.id;

                return `
                    <div class="client-card">
                        <div class="client-header">
                            <div class="client-info">
                                <h3>
                                    ${client.name}
                                    <span class="badge">${client.totalSessions || 0} seans</span>
                                </h3>
                                <div class="client-details">
                                    <div>üì± ${client.phone}</div>
                                    ${client.email ? `<div>üìß ${client.email}</div>` : ''}
                                    ${client.complaints ? `<div style="color: #ef4444;">‚ö†Ô∏è ${client.complaints}</div>` : ''}
                                </div>
                            </div>
                            <div class="client-actions">
                                <button class="btn btn-icon" onclick="toggleClientExpanded('${client.id}')" title="Detaylarƒ± g√∂ster">
                                    ${isExpanded ? 'üîº' : 'üîΩ'}
                                </button>
                                <button class="btn btn-icon" onclick="openAddSessionModal('${client.id}')" title="Yeni seans">
                                    ‚ûï
                                </button>
                                <button class="btn btn-icon" onclick="deleteClient('${client.id}')" title="Sil">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        ${isExpanded ? `
                            <div class="client-expanded">
                                <div class="detail-section">
                                    ${client.birthDate ? `<div><strong>Doƒüum Tarihi:</strong> ${new Date(client.birthDate).toLocaleDateString('tr-TR')}</div>` : ''}
                                    ${client.medicalHistory ? `<div><strong>Tƒ±bbi Ge√ßmi≈ü:</strong> ${client.medicalHistory}</div>` : ''}
                                    ${client.goals ? `<div><strong>Hedefler:</strong> ${client.goals}</div>` : ''}
                                    ${client.notes ? `<div><strong>Notlar:</strong> ${client.notes}</div>` : ''}
                                </div>
                                <div class="sessions-list">
                                    <h4 style="margin-bottom: 15px; color: #333;">Seanslar (${clientSessions.length})</h4>
                                    ${clientSessions.length === 0 ? '<p style="color: #999;">Hen√ºz seans kaydƒ± yok</p>' : 
                                        clientSessions.map(session => `
                                            <div class="session-card">
                                                <div class="session-header">
                                                    <div>
                                                        <span class="session-type">${session.type}</span>
                                                        <span style="color: #666; font-size: 14px; margin-left: 10px;">
                                                            ${new Date(session.date).toLocaleDateString('tr-TR')} ‚Ä¢ ${session.duration} dk
                                                        </span>
                                                    </div>
                                                    <button class="btn-icon" onclick="deleteSession('${session.id}')">
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                                <div class="session-details">
                                                    ${session.complaints ? `<div><strong>≈ûikayet:</strong> ${session.complaints}</div>` : ''}
                                                    ${session.treatment ? `<div><strong>Tedavi:</strong> ${session.treatment}</div>` : ''}
                                                    ${session.homeProgram ? `<div><strong>Ev Programƒ±:</strong> ${session.homeProgram}</div>` : ''}
                                                </div>
                                            </div>
                                        `).join('')
                                    }
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            document.getElementById('totalClients').textContent = clients.length;
            document.getElementById('totalSessions').textContent = sessions.length;
            
            const now = new Date();
            const thisMonth = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === now.getMonth() && 
                       sessionDate.getFullYear() === now.getFullYear();
            }).length;
            document.getElementById('thisMonthSessions').textContent = thisMonth;
        }

        function switchTab(tab) {
            // Tab butonlarƒ±nƒ± g√ºncelle
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Sayfalarƒ± deƒüi≈ütir
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            if (tab === 'clients') {
                document.getElementById('clientsPage').classList.add('active');
            } else if (tab === 'calendar') {
                document.getElementById('calendarPage').classList.add('active');
                renderCalendar();
            } else if (tab === 'finance') {
                document.getElementById('financePage').classList.add('active');
                renderFinancePage();
            } else if (tab === 'reports') {
                document.getElementById('reportsPage').classList.add('active');
                renderReports();
            }
        }

        // Filter Functions
        function applyFilters() {
            renderClients();
        }

        function clearFilters() {
            document.getElementById('filterStatus').value = 'all';
            document.getElementById('filterSessionType').value = 'all';
            document.getElementById('filterPayment').value = 'all';
            document.getElementById('searchInput').value = '';
            renderClients();
        }

        function renderCalendar() {
            const viewType = document.getElementById('calendarViewType').value;
            const filterType = document.getElementById('calendarFilterType').value;

            if (viewType === 'week') {
                renderWeekView(filterType);
            } else {
                renderMonthView(filterType);
            }
        }

        function renderMonthView(filterType) {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Ay ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle
            const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
                               'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;

            // ƒ∞statistikleri hesapla ve g√∂ster
            const monthSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === month && sessionDate.getFullYear() === year;
            });

            const physioCount = monthSessions.filter(s => s.type.includes('Fizyoterapi')).length;
            const pilatesCount = monthSessions.filter(s => s.type.includes('Pilates')).length;
            const yogaCount = monthSessions.filter(s => s.type.includes('Yoga')).length;
            const uniqueClients = new Set(monthSessions.map(s => s.clientId)).size;

            document.getElementById('calendarStats').innerHTML = `
                <div class="calendar-stat">
                    <h4>Toplam Seans</h4>
                    <div class="stat-value">${monthSessions.length}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #10b981;">
                    <h4>Aktif Danƒ±≈üan</h4>
                    <div class="stat-value">${uniqueClients}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #667eea;">
                    <h4>Fizyoterapi</h4>
                    <div class="stat-value">${physioCount}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #10b981;">
                    <h4>Pilates</h4>
                    <div class="stat-value">${pilatesCount}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #8b5cf6;">
                    <h4>Yoga</h4>
                    <div class="stat-value">${yogaCount}</div>
                </div>
            `;

            // Takvim grid'ini olu≈ütur
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - (firstDay.getDay() || 7) + 1);

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // G√ºn ba≈ülƒ±klarƒ±
            const dayHeaders = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // G√ºnleri olu≈ütur
            const currentDate = new Date(startDate);
            for (let i = 0; i < 42; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                if (currentDate.getMonth() !== month) {
                    dayDiv.classList.add('other-month');
                }
                
                const today = new Date();
                if (currentDate.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }

                const dayNumber = document.createElement('div');
                dayNumber.className = 'calendar-day-number';
                dayNumber.textContent = currentDate.getDate();
                
                // Bug√ºn i≈üareti ekle
                if (currentDate.toDateString() === today.toDateString()) {
                    const todayBadge = document.createElement('span');
                    todayBadge.className = 'today-indicator';
                    todayBadge.textContent = 'BUG√úN';
                    dayNumber.appendChild(todayBadge);
                }
                
                dayDiv.appendChild(dayNumber);

                // Bu g√ºne ait seanslarƒ± bul
                const dateStr = currentDate.toISOString().split('T')[0];
                let daySessions = sessions.filter(s => s.date === dateStr);

                // Filtreleme uygula
                if (filterType !== 'all') {
                    daySessions = daySessions.filter(s => s.type === filterType);
                }

                // Seans sayƒ±sƒ± g√∂stergesi
                if (daySessions.length > 0) {
                    const countBadge = document.createElement('div');
                    countBadge.style.cssText = 'font-size: 10px; color: #667eea; font-weight: 600; margin-bottom: 4px;';
                    countBadge.textContent = `${daySessions.length} seans`;
                    dayDiv.appendChild(countBadge);
                }

                daySessions.forEach(session => {
                    const client = clients.find(c => c.id === session.clientId);
                    if (client) {
                        const eventDiv = document.createElement('div');
                        eventDiv.className = 'calendar-event';
                        
                        if (session.type.includes('Fizyoterapi')) {
                            eventDiv.classList.add('physio');
                        } else if (session.type.includes('Pilates')) {
                            eventDiv.classList.add('pilates');
                        } else if (session.type.includes('Yoga')) {
                            eventDiv.classList.add('yoga');
                        } else {
                            eventDiv.style.background = '#f59e0b';
                        }
                        
                        eventDiv.textContent = `${client.name.split(' ')[0]} - ${session.type}`;
                        eventDiv.title = `${client.name}\n${session.type}\n${session.duration} dk\n${session.complaints || ''}`;
                        eventDiv.draggable = true;
                        eventDiv.ondragstart = (e) => {
                            e.dataTransfer.setData('sessionId', session.id);
                        };
                        eventDiv.onclick = () => {
                            alert(`üìã Seans Detaylarƒ±\n\nüë§ Danƒ±≈üan: ${client.name}\nüìû Telefon: ${client.phone}\nüè• T√ºr: ${session.type}\n‚è±Ô∏è S√ºre: ${session.duration} dk\nüìÖ Tarih: ${new Date(session.date).toLocaleDateString('tr-TR')}\n\n${session.complaints ? '‚ö†Ô∏è ≈ûikayet: ' + session.complaints : ''}\n${session.treatment ? '\nüíä Tedavi: ' + session.treatment : ''}`);
                        };
                        dayDiv.appendChild(eventDiv);
                    }
                });

                // Drag & drop √∂zelliƒüi
                dayDiv.ondragover = (e) => {
                    e.preventDefault();
                    dayDiv.classList.add('drag-over');
                };
                dayDiv.ondragleave = () => {
                    dayDiv.classList.remove('drag-over');
                };
                dayDiv.ondrop = (e) => {
                    e.preventDefault();
                    dayDiv.classList.remove('drag-over');
                    const sessionId = e.dataTransfer.getData('sessionId');
                    const session = sessions.find(s => s.id === sessionId);
                    if (session && currentDate.getMonth() === month) {
                        session.date = currentDate.toISOString().split('T')[0];
                        saveData();
                        renderCalendar();
                    }
                };

                grid.appendChild(dayDiv);
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // Seanslarƒ± √∂zetle
            renderSessionsSummary();
        }

        function renderWeekView(filterType) {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
                               'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year} - Haftalƒ±k G√∂r√ºn√ºm`;

            // Bu haftanƒ±n ba≈ülangƒ±√ß tarihini bul
            const today = new Date(currentCalendarDate);
            const dayOfWeek = today.getDay() || 7; // Pazar = 0 -> 7
            const monday = new Date(today);
            monday.setDate(today.getDate() - dayOfWeek + 1);

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = 'auto repeat(7, 1fr)';

            // Saat ba≈ülƒ±klarƒ±
            const emptyHeader = document.createElement('div');
            emptyHeader.className = 'calendar-day-header';
            emptyHeader.textContent = 'Saat';
            grid.appendChild(emptyHeader);

            const dayHeaders = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = `${dayHeaders[i]} ${date.getDate()}`;
                grid.appendChild(header);
            }

            // Saat dilimleri (08:00 - 20:00)
            for (let hour = 8; hour <= 20; hour++) {
                // Saat etiketi
                const timeLabel = document.createElement('div');
                timeLabel.className = 'calendar-day-header';
                timeLabel.textContent = `${hour.toString().padStart(2, '0')}:00`;
                timeLabel.style.fontSize = '12px';
                grid.appendChild(timeLabel);

                // Her g√ºn i√ßin
                for (let day = 0; day < 7; day++) {
                    const date = new Date(monday);
                    date.setDate(monday.getDate() + day);
                    const dateStr = date.toISOString().split('T')[0];

                    const slot = document.createElement('div');
                    slot.className = 'calendar-day calendar-time-slot';
                    
                    let daySessions = sessions.filter(s => {
                        if (s.date !== dateStr) return false;
                        const sessionHour = parseInt(s.time?.split(':')[0] || '9');
                        return sessionHour === hour;
                    });

                    if (filterType !== 'all') {
                        daySessions = daySessions.filter(s => s.type === filterType);
                    }

                    daySessions.forEach(session => {
                        const client = clients.find(c => c.id === session.clientId);
                        if (client) {
                            const event = document.createElement('div');
                            event.className = 'time-event';
                            if (session.type.includes('Fizyoterapi')) event.style.background = '#667eea';
                            else if (session.type.includes('Pilates')) event.style.background = '#10b981';
                            else if (session.type.includes('Yoga')) event.style.background = '#8b5cf6';
                            
                            event.textContent = `${session.time || ''} ${client.name.split(' ')[0]}`;
                            event.draggable = true;
                            event.ondragstart = (e) => {
                                e.dataTransfer.setData('sessionId', session.id);
                            };
                            slot.appendChild(event);
                        }
                    });

                    slot.ondragover = (e) => {
                        e.preventDefault();
                        slot.classList.add('drag-over');
                    };
                    slot.ondragleave = () => {
                        slot.classList.remove('drag-over');
                    };
                    slot.ondrop = (e) => {
                        e.preventDefault();
                        slot.classList.remove('drag-over');
                        const sessionId = e.dataTransfer.getData('sessionId');
                        const session = sessions.find(s => s.id === sessionId);
                        if (session) {
                            session.date = dateStr;
                            session.time = `${hour.toString().padStart(2, '0')}:00`;
                            saveData();
                            renderCalendar();
                        }
                    };

                    grid.appendChild(slot);
                }
            }

            // ƒ∞statistikleri g√ºncelle (aylƒ±k g√∂r√ºn√ºm kodundan)
            const monthSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === month && sessionDate.getFullYear() === year;
            });

            const physioCount = monthSessions.filter(s => s.type.includes('Fizyoterapi')).length;
            const pilatesCount = monthSessions.filter(s => s.type.includes('Pilates')).length;
            const yogaCount = monthSessions.filter(s => s.type.includes('Yoga')).length;
            const uniqueClients = new Set(monthSessions.map(s => s.clientId)).size;

            document.getElementById('calendarStats').innerHTML = `
                <div class="calendar-stat">
                    <h4>Toplam Seans</h4>
                    <div class="stat-value">${monthSessions.length}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #10b981;">
                    <h4>Aktif Danƒ±≈üan</h4>
                    <div class="stat-value">${uniqueClients}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #667eea;">
                    <h4>Fizyoterapi</h4>
                    <div class="stat-value">${physioCount}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #10b981;">
                    <h4>Pilates</h4>
                    <div class="stat-value">${pilatesCount}</div>
                </div>
                <div class="calendar-stat" style="border-left-color: #8b5cf6;">
                    <h4>Yoga</h4>
                    <div class="stat-value">${yogaCount}</div>
                </div>
            `;

            renderSessionsSummary();
        }

        function renderSessionsSummary() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const monthSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === month && sessionDate.getFullYear() === year;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));

            const container = document.getElementById('sessionsSummary');

            if (monthSessions.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Bu ay i√ßin seans kaydƒ± yok</p></div>';
                return;
            }

            // G√ºnlere g√∂re grupla
            const sessionsByDay = {};
            monthSessions.forEach(session => {
                if (!sessionsByDay[session.date]) {
                    sessionsByDay[session.date] = [];
                }
                sessionsByDay[session.date].push(session);
            });

            container.innerHTML = Object.keys(sessionsByDay).map(date => {
                const daySessions = sessionsByDay[date];
                const dateObj = new Date(date);
                const dayName = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'][dateObj.getDay()];
                
                return `
                    <div class="session-day-group">
                        <div class="session-day-title">
                            ${dayName}, ${dateObj.getDate()} ${['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
                               'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'][dateObj.getMonth()]}
                        </div>
                        ${daySessions.map(session => {
                            const client = clients.find(c => c.id === session.clientId);
                            return `
                                <div class="session-card">
                                    <div class="session-header">
                                        <div>
                                            <span class="session-type">${session.type}</span>
                                            <span style="color: #666; font-size: 14px; margin-left: 10px;">
                                                ${client ? client.name : 'Bilinmeyen'} ‚Ä¢ ${session.duration} dk
                                            </span>
                                        </div>
                                        <button class="btn-icon" onclick="deleteSession('${session.id}')">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                    <div class="session-details">
                                        ${session.complaints ? `<div><strong>≈ûikayet:</strong> ${session.complaints}</div>` : ''}
                                        ${session.treatment ? `<div><strong>Tedavi:</strong> ${session.treatment}</div>` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }).join('');
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentCalendarDate = new Date();
            renderCalendar();
        }

        // Reports Functions
        function renderReports() {
            renderMonthlySessionChart();
            renderSessionTypeChart();
            renderTopClients();
            renderIncomeChart();
            renderWeeklyChart();
            renderPackageStatusChart();
        }

        function renderMonthlySessionChart() {
            const now = new Date();
            const monthlyData = {};
            
            // Son 6 ayƒ±n verisini hazƒ±rla
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                monthlyData[key] = 0;
            }

            // Seanslarƒ± say
            sessions.forEach(s => {
                const date = new Date(s.date);
                const key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                if (monthlyData.hasOwnProperty(key)) {
                    monthlyData[key]++;
                }
            });

            const maxValue = Math.max(...Object.values(monthlyData), 1);
            const container = document.getElementById('monthlySessionChart');
            
            container.innerHTML = Object.entries(monthlyData).map(([month, count]) => {
                const [year, m] = month.split('-');
                const monthNames = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Aƒüu', 'Eyl', 'Eki', 'Kas', 'Ara'];
                const label = `${monthNames[parseInt(m) - 1]} ${year}`;
                const percent = (count / maxValue) * 100;
                
                return `
                    <div class="bar-item">
                        <div class="bar-label">${label}</div>
                        <div class="bar-background">
                            <div class="bar-fill" style="width: ${percent}%">${count}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderSessionTypeChart() {
            const typeCount = {};
            sessions.forEach(s => {
                typeCount[s.type] = (typeCount[s.type] || 0) + 1;
            });

            const maxValue = Math.max(...Object.values(typeCount), 1);
            const container = document.getElementById('sessionTypeChart');
            const colors = {
                'Fizyoterapi': '#667eea',
                'Reformer Pilates': '#10b981',
                'Yoga': '#8b5cf6',
                'Mat Pilates': '#f59e0b'
            };
            
            container.innerHTML = Object.entries(typeCount)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => {
                    const percent = (count / maxValue) * 100;
                    const color = colors[type] || '#6b7280';
                    
                    return `
                        <div class="bar-item">
                            <div class="bar-label">${type}</div>
                            <div class="bar-background">
                                <div class="bar-fill" style="width: ${percent}%; background: ${color}">${count} seans</div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function renderTopClients() {
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

            const clientSessionCount = {};
            sessions.forEach(s => {
                if (new Date(s.date) >= thirtyDaysAgo) {
                    clientSessionCount[s.clientId] = (clientSessionCount[s.clientId] || 0) + 1;
                }
            });

            const topClients = Object.entries(clientSessionCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            const container = document.getElementById('topClientsChart');
            
            if (topClients.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">Son 30 g√ºnde seans yok</p>';
                return;
            }

            container.innerHTML = topClients.map(([clientId, count], index) => {
                const client = clients.find(c => c.id === clientId);
                if (!client) return '';
                
                return `
                    <div class="top-client-item">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="top-client-rank">${index + 1}</div>
                            <div>
                                <strong>${client.name}</strong>
                                <div style="font-size: 12px; color: #666;">${client.phone}</div>
                            </div>
                        </div>
                        <div style="font-size: 18px; font-weight: bold; color: #667eea;">
                            ${count} seans
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderIncomeChart() {
            const now = new Date();
            const monthlyIncome = {};
            
            // Son 6 ayƒ± hazƒ±rla
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                monthlyIncome[key] = 0;
            }

            // √ñdemeleri grupla
            payments.forEach(p => {
                const date = new Date(p.date);
                const key = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                if (monthlyIncome.hasOwnProperty(key)) {
                    monthlyIncome[key] += p.amount;
                }
            });

            const maxValue = Math.max(...Object.values(monthlyIncome), 1);
            const container = document.getElementById('incomeChart');
            const monthNames = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Aƒüu', 'Eyl', 'Eki', 'Kas', 'Ara'];
            
            container.innerHTML = Object.entries(monthlyIncome).map(([month, amount]) => {
                const [year, m] = month.split('-');
                const label = `${monthNames[parseInt(m) - 1]} ${year}`;
                const percent = (amount / maxValue) * 100;
                
                return `
                    <div class="bar-item">
                        <div class="bar-label">${label}</div>
                        <div class="bar-background">
                            <div class="bar-fill" style="width: ${percent}%; background: #10b981">
                                ${amount.toFixed(0)} ‚Ç∫
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderWeeklyChart() {
            const dayCount = {
                'Pazartesi': 0, 'Salƒ±': 0, '√áar≈üamba': 0, 'Per≈üembe': 0,
                'Cuma': 0, 'Cumartesi': 0, 'Pazar': 0
            };

            sessions.forEach(s => {
                const date = new Date(s.date);
                const dayNames = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'];
                const dayName = dayNames[date.getDay()];
                dayCount[dayName]++;
            });

            const maxValue = Math.max(...Object.values(dayCount), 1);
            const container = document.getElementById('weeklyChart');
            const orderedDays = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
            
            container.innerHTML = orderedDays.map(day => {
                const count = dayCount[day];
                const percent = (count / maxValue) * 100;
                
                return `
                    <div class="bar-item">
                        <div class="bar-label">${day}</div>
                        <div class="bar-background">
                            <div class="bar-fill" style="width: ${percent}%">${count} seans</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPackageStatusChart() {
            const activePackages = packages.filter(p => p.status === 'active').length;
            const completedPackages = packages.filter(p => p.status === 'completed').length;
            const totalRevenue = packages.reduce((sum, p) => sum + p.paidAmount, 0);
            const totalValue = packages.reduce((sum, p) => sum + p.price, 0);

            const container = document.getElementById('packageStatusChart');
            container.innerHTML = `
                <div class="bar-item">
                    <div class="bar-label">Aktif Paketler</div>
                    <div class="bar-background">
                        <div class="bar-fill" style="width: ${activePackages ? 100 : 0}%; background: #10b981">
                            ${activePackages} paket
                        </div>
                    </div>
                </div>
                <div class="bar-item">
                    <div class="bar-label">Tamamlanan Paketler</div>
                    <div class="bar-background">
                        <div class="bar-fill" style="width: ${completedPackages ? 100 : 0}%; background: #6b7280">
                            ${completedPackages} paket
                        </div>
                    </div>
                </div>
                <div class="bar-item">
                    <div class="bar-label">Toplam Paket Geliri</div>
                    <div class="bar-background">
                        <div class="bar-fill" style="width: 100%; background: #667eea">
                            ${totalRevenue.toFixed(0)} ‚Ç∫
                        </div>
                    </div>
                </div>
                <div class="bar-item">
                    <div class="bar-label">Tahsilat Oranƒ±</div>
                    <div class="bar-background">
                        <div class="bar-fill" style="width: ${totalValue ? (totalRevenue / totalValue * 100) : 0}%; background: #f59e0b">
                      F      %${totalValue ? ((totalRevenue / totalValue * 100).toFixed(1)) : 0}
                        </div>
                    </div>
                </div>
            `;
        }

        // Modal dƒ±≈üƒ±na tƒ±klandƒ±ƒüƒ±nda kapat
        window.onclick = function(event) {
            const clientModal = document.getElementById('addClientModal');
            const sessionModal = document.getElementById('addSessionModal');
            
            if (event.target === clientModal) {
                closeAddClientModal();
            }
            if (event.target === sessionModal) {
                closeAddSessionModal();
            }
        }
    </script>
</body>
</html>